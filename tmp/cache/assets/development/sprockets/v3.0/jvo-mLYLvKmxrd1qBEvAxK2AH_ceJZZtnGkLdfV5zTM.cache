I"((function() {
  var geocodeLatLng;

  window.onload = function() {
    return rate(gon.restaurant, false);
  };

  google.maps.event.addDomListener(window, 'load', function() {
    var marker;
    initmap();
    marker = new google.maps.Marker({
      map: map,
      animation: google.maps.Animation.DROP,
      draggable: true
    });
    google.maps.event.addListener(map, 'click', function(event) {
      marker.setPosition(event.latLng);
      $("#lat").val(event.latLng.lat());
      $("#lng").val(event.latLng.lng());
      return geocodeLatLng(event.latLng);
    });
    google.maps.event.addListener(marker, 'drag', function(event) {
      $("#lat").val(event.latLng.lat());
      return $("#lng").val(event.latLng.lng());
    });
    return google.maps.event.addListener(marker, 'dragend', function(event) {
      $("#lat").val(event.latLng.lat());
      $("#lng").val(event.latLng.lng());
      return geocodeLatLng(marker.getPosition());
    });
  });

  geocodeLatLng = function(pos) {
    var xmlHttp;
    xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() {
      if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
        return $('input[name="review[address]"]').val(JSON.parse(xmlHttp.responseText).response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.AddressDetails.Country.AddressLine);
      }
    };
    xmlHttp.open("GET", "https://geocode-maps.yandex.ru/1.x/?sco=latlong&format=json&geocode=" + pos.lat() + "," + pos.lng(), true);
    return xmlHttp.send(null);
  };

}).call(this);
:ET