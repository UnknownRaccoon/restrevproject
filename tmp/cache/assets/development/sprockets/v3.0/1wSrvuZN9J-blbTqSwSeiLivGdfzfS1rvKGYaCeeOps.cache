I"4(function() {
  var geocodeLatLng;

  window.onload = function() {
    rate(gon.restaurant, false);
    return marker.setPosition(map.getCenter());
  };

  google.maps.event.addDomListener(window, 'load', function() {
    initmap();
    window.marker = new google.maps.Marker({
      map: map,
      animation: google.maps.Animation.DROP,
      draggable: true,
      position: map.getCenter()
    });
    google.maps.event.addListener(map, 'click', function(event) {
      marker.setPosition(event.latLng);
      $("#lat").val(event.latLng.lat());
      $("#lng").val(event.latLng.lng());
      return geocodeLatLng(event.latLng);
    });
    google.maps.event.addListener(marker, 'drag', function(event) {
      $("#lat").val(event.latLng.lat());
      return $("#lng").val(event.latLng.lng());
    });
    return google.maps.event.addListener(marker, 'dragend', function(event) {
      $("#lat").val(event.latLng.lat());
      $("#lng").val(event.latLng.lng());
      return geocodeLatLng(marker.getPosition());
    });
  });

  geocodeLatLng = function(position) {
    var geocoder;
    geocoder = new google.maps.Geocoder();
    return geocoder.geocode({
      'location': position
    }, function(results, status) {
      if (status === google.maps.GeocoderStatus.OK) {
        if (results[1]) {
          return $('input[name="review[address]"]').val(results[0].formatted_address);
        } else {
          return $('input[name="review[address]"]').val("");
        }
      } else {
        return $('input[name="review[address]"]').val("");
      }
    });
  };

}).call(this);
:ET